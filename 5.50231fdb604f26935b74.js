(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"6zjG":function(t,e,n){"use strict";n.r(e),n.d(e,"PrivateRoutingModule",(function(){return Bt}));var o=n("tyNb"),i=n("Ilre"),r=n("mrSG"),a=n("3Pt+"),c=n("itXk"),s=n("lJxs"),l=n("J1Ni"),u=n("zTUo"),b=n("2liE");function p(t={level:b.a.DEBUG,logReturn:!1,logError:!1}){return(e,n,o)=>{const i=o.value;return o.value=function(...o){const r=()=>`[LogMethodCall]: ${e.constructor.name}.${n}(${o}) `;u.a.log(t.level,r(),o);try{const e=i.apply(this,o);return t.logReturn&&u.a.log(t.level,`${r()} RETURNS: ${e}`,e),e}catch(a){throw t.logError&&u.a.log(t.level,`${r()} ERROR: ${a}`,a),a}},o}}var g=n("fXoL"),f=n("tk/3"),d=n("AytR"),m=n("UXun"),h=n("JIr8"),k=n("z6cu"),S=n("dNgK"),v=n("/AaM");let y=(()=>{class t{constructor(t,e,n){this.snackbar=t,this.router=e,this.authService=n}catchInstitutionsError(){return Object(h.a)(t=>(this.snackbarWithLogout(),Object(k.a)(t)))}catchAreasError(){return Object(h.a)(t=>(this.snackbarWithLogout(),Object(k.a)(t)))}catchTimeslotsError(){return Object(h.a)(t=>(this.snackbarWithLogout(),Object(k.a)(t)))}catchBookingError(){return Object(h.a)(t=>{if("sessionerror"===t.message)throw this.snackbarWithLogout("Ihre Session ist abgelaufen!"),new Error(t.message);return this.snackbar.open({"":"Es konnte kein Arbeitsplatz zu diesen Bedingungen gefunden werden",concurrently_booking:"Sie haben breits einen Arbeitsplatz zu dieser Zeit",server_error:"Unbekannter Fehler (Versuchen Sie sich ab und wieder anzumelden)",outofreach:"Sie k\xf6nnen nur innerhalb der n\xe4chsten 7 Tage buchen!",outofdate:"Der Buchungszeitrum ist au\xdferhalb der \xd6ffnungszeiten",notbookable2:"Die Bibliothek ist vom 03.08 bis 14.08. geschlossen!",notbookable3:"Die Bibliothek ist ab dem 03.08.2020 nur bis 16 Uhr ge\xf6ffnet!",outoftime:"Der Buchungszeitrum ist au\xdferhalb der \xd6ffnungszeiten",concurrent_error:"Fehler bei der Buchung, bitte versuchen Sie es erneut!"}[null==t?void 0:t.message]||"Unbekannter Fehler","Ok",{duration:5e3}),Object(k.a)(t)})}snackbarWithLogout(t="Fehler beim Laden! Bitte melden Sie sich erneut an.",e="Anmelden"){this.snackbar.open(t,e,{duration:-1}).afterDismissed().subscribe(()=>{this.authService.logout()})}}return t.\u0275fac=function(e){return new(e||t)(g.Wb(S.a),g.Wb(o.b),g.Wb(v.a))},t.\u0275prov=g.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),w=(()=>{class t{constructor(t,e){this.http=t,this.errorSerivce=e,this.institutionApi=d.a.api.basePath+d.a.api.institution,this.timeslotsApi=d.a.api.basePath+d.a.api.timeslots,this.areasApi=d.a.api.basePath+d.a.api.areas}getInstitutions(){return this.http.get(this.institutionApi,{responseType:"text"}).pipe(Object(s.a)(t=>t.split("#")),this.errorSerivce.catchInstitutionsError(),Object(m.a)(1))}getTimesolts(t){const e=(new f.d).set("institution",t);return this.http.get(this.timeslotsApi,{params:e}).pipe(this.errorSerivce.catchTimeslotsError())}getAreas(t){const e=(new f.d).set("institution",t);return this.http.get(this.areasApi,{params:e,responseType:"text"}).pipe(this.errorSerivce.catchAreasError(),Object(s.a)(t=>t.split("#")))}}return t.\u0275fac=function(e){return new(e||t)(g.Wb(f.a),g.Wb(y))},t.\u0275prov=g.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),A=(()=>{class t{constructor(t){this.authService=t}getPreferedInstitution(){return localStorage.getItem(this.authService.getReaderNumber()+":institution")}setPreferedInstitution(t){return localStorage.setItem(this.authService.getReaderNumber()+":institution",t)}getPreferedSeat(t,e){const n=e.getRawValue(),o=JSON.parse(localStorage.getItem(this.authService.getReaderNumber()+t+":seat")||"{}");e.get("area").setValue(o.area||"no selection"),e.get("fitting").setValue(o.fitting||[]),e.get("from_date").setValue(n.from_date||new Date),e.get("from_time").setValue(n.from_time||o.from_time||(new Date).getHours()+1+":00"),e.get("until_time").setValue(n.until_time||o.until_time||null)}setPreferedSeat(t,e){const n=Object.assign({},e.getRawValue());localStorage.setItem(this.authService.getReaderNumber()+t+":seat",JSON.stringify(n))}}return t.\u0275fac=function(e){return new(e||t)(g.Wb(v.a))},t.\u0275prov=g.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var I=n("2Vo4"),O=n("LRne"),R=n("5+tZ"),x=n("vkgz"),j=n("eIep");let F=(()=>{class t{constructor(t,e,n,o){this.http=t,this.authService=e,this.snackbar=n,this.errorService=o,this.bookingApi=d.a.api.basePath+d.a.api.booking,this.bookingsApi=d.a.api.basePath+d.a.api.bookings,this.stornoApi=d.a.api.basePath+d.a.api.strono,this.updateBookings$=new I.a(null)}book(t){let e=new f.d;return t.token=this.authService.getToken(),t.readernumber=this.authService.getReaderNumber(),Object.keys(t).forEach(n=>{"fitting"===n?t[n].forEach(t=>{e=e.append("fitting",t)}):e=e.set(n,t[n])}),e=e.append("tslot","0"),e=e.append("preference","0"),this.http.post(this.bookingApi,e.toString(),{headers:(new f.c).set("Content-Type","application/x-www-form-urlencoded")}).pipe(Object(s.a)(t=>{if(!t||""===t.bookingCode)throw new Error(t.message);return t}),this.errorService.catchBookingError(),Object(R.a)(t=>this.authService.refreshToken().pipe(Object(s.a)(e=>t))),Object(x.a)(()=>this.updateBookings$.next()))}cancelBooking(t,e,n){const o=(new f.d).set("readernumber",this.authService.getReaderNumber()).set("token",this.authService.getAdminToken()).set("from",e).set("until",n).set("bookingcode",t);return console.log(o.toString(),e,n),this.http.post(this.stornoApi,o.toString(),{headers:(new f.c).set("Content-Type","application/x-www-form-urlencoded")}).pipe(Object(s.a)(t=>(this.snackbar.open(t.message,null,{duration:5e3}),"Ihre Buchung wurde gel\xf6scht."===t.message)),Object(R.a)(t=>this.authService.refreshToken().pipe(Object(s.a)(e=>t))),Object(x.a)(()=>this.updateBookings$.next()),Object(h.a)(t=>Object(O.a)(!1)))}getBookings(){return this.bookingCache$||(this.bookingCache$=this.updateBookings$.pipe(Object(j.a)(()=>this.http.post(this.bookingsApi,JSON.stringify({token:this.authService.getAdminToken(),readernumber:this.authService.getReaderNumber()}),{headers:(new f.c).set("Content-Type","application/x-www-form-urlencoded")}).pipe(Object(R.a)(t=>t&&t.bookings?Object(O.a)(t.bookings):this.authService.refreshToken().pipe(Object(s.a)(()=>[]))))),Object(m.a)(1))),this.bookingCache$}getBooking(t){return this.getBookings().pipe(Object(s.a)(e=>e.find(e=>e.bookingCode===t)))}reloadBookings(){this.updateBookings$.next()}}return t.\u0275fac=function(e){return new(e||t)(g.Wb(f.a),g.Wb(v.a),g.Wb(S.a),g.Wb(y))},t.\u0275prov=g.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),C=(()=>{class t{constructor(t){this.http=t,this.workloadApi=d.a.api.basePath+d.a.api.workload}getWorkload(t){const e=(new f.d).set("institution",t);return this.http.get(this.workloadApi,{params:e,responseType:"text"}).pipe(this.workloadParser())}workloadParser(){return Object(s.a)(t=>{const e=[],n="<th>(.*?) Uhr</th>",o=Number.parseInt(new RegExp(n).exec(t)[1],10),i=t.match(new RegExp(n,"g")).length;e.startHour=o,e.hours=i;const r=t.match(new RegExp("<td style='background-color:(.*?)'>","g")).map(t=>/<td style='background-color:(.*?)'>/.exec(t)[1]);for(let a=0;a<8;a++){const t=[];for(let e=0;e<i;e++)t.push({green:0,yellow:1,red:2}[r[8*e+a]]);e.push(t)}return e})}}return t.\u0275fac=function(e){return new(e||t)(g.Wb(f.a))},t.\u0275prov=g.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var T=n("XiUz"),G=n("kmnG"),B=n("d3UM"),N=n("ofXK"),P=n("FKr1");function L(t,e){if(1&t&&(g.Sb(0,"mat-option",4),g.yc(1),g.Rb()),2&t){const t=e.$implicit;g.jc("value",t),g.Ab(1),g.Ac(" ",t," ")}}let M=(()=>{class t{constructor(){}get selectedInstitution(){return this.institution}set selectedInstitution(t){this.institution=t,this.onChange&&this.onChange(t),this.onTouch&&this.onTouch()}writeValue(t){this.institution=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}setDisabledState(t){this.isDisabled=t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Gb({type:t,selectors:[["app-institution-select"]],inputs:{institutions:"institutions"},features:[g.zb([{provide:a.i,useExisting:Object(g.U)(()=>t),multi:!0}])],decls:6,vars:3,consts:[["fxFlex",""],["required","",3,"ngModel","disabled","ngModelChange"],["institutionSelect",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(g.Sb(0,"mat-form-field",0),g.Sb(1,"mat-label"),g.yc(2,"Standort"),g.Rb(),g.Sb(3,"mat-select",1,2),g.ac("ngModelChange",(function(t){return e.selectedInstitution=t})),g.wc(5,L,2,2,"mat-option",3),g.Rb(),g.Rb()),2&t&&(g.Ab(3),g.jc("ngModel",e.selectedInstitution)("disabled",e.isDisabled),g.Ab(2),g.jc("ngForOf",e.institutions))},directives:[G.c,T.a,G.f,B.a,a.p,a.k,a.n,N.l,P.l],styles:[""]}),t})(),_=(()=>{class t{constructor(){this.days={1:"Sonntag",2:"Montag",3:"Dienstag",4:"Mittwoch",5:"Donnerstag",6:"Freitag",7:"Samstag"}}transform(t,...e){return this.getDayAsString(t.day)+t.from+" Uhr - "+t.until+" Uhr"}getDayAsString(t){return t?this.days[t]+": ":""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=g.Lb({name:"timeslotInterval",type:t,pure:!0}),t})();function D(t,e){if(1&t&&(g.Sb(0,"div"),g.yc(1),g.ec(2,"timeslotInterval"),g.Rb()),2&t){const t=e.$implicit;g.Ab(1),g.Ac(" ",g.fc(2,1,t)," ")}}let E=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Gb({type:t,selectors:[["app-opening-hours"]],inputs:{intervals:"intervals"},decls:5,vars:1,consts:[["fxLayout","row","fxLayoutGap","16px"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(g.Sb(0,"div",0),g.Sb(1,"span"),g.yc(2,"\xd6ffnungszeiten:"),g.Rb(),g.Sb(3,"div"),g.wc(4,D,3,3,"div",1),g.Rb(),g.Rb()),2&t&&(g.Ab(4),g.jc("ngForOf",e.intervals))},directives:[T.c,T.d,N.l],pipes:[_],styles:[""]}),t})();function $(t,e){if(1&t&&(g.Sb(0,"mat-option",2),g.yc(1),g.Rb()),2&t){const t=e.$implicit;g.jc("value",t),g.Ab(1),g.Ac(" ",t," ")}}let z=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Gb({type:t,selectors:[["app-area-select"]],inputs:{control:"control",areas:"areas"},decls:7,vars:3,consts:[["fxFlex",""],[3,"formControl"],[3,"value"],[3,"value",4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(g.Sb(0,"mat-form-field",0),g.Sb(1,"mat-label"),g.yc(2,"Bereich"),g.Rb(),g.Sb(3,"mat-select",1),g.Sb(4,"mat-option",2),g.yc(5," Alle Bereiche "),g.Rb(),g.wc(6,$,2,2,"mat-option",3),g.Rb(),g.Rb()),2&t&&(g.Ab(3),g.jc("formControl",e.control),g.Ab(1),g.jc("value","no selection"),g.Ab(2),g.jc("ngForOf",e.areas))},directives:[G.c,T.a,G.f,B.a,a.k,a.d,P.l,N.l],styles:[""]}),t})();function H(t,e){if(1&t&&(g.Sb(0,"mat-option",3),g.yc(1),g.Rb()),2&t){const t=e.$implicit;g.jc("value",t.key),g.Ab(1),g.Ac(" ",t.value," ")}}let U=(()=>{class t{constructor(){this.accessories={"mit Strom":"mit Stromanschluss",PC:"mit PC","kein PC":"ohne PC",LAN:"mit LAN-Anschluss",Steharbeitsplatz:"Steharbeitsplatz"}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Gb({type:t,selectors:[["app-accessories-select"]],inputs:{control:"control"},decls:6,vars:4,consts:[["fxFlex",""],["multiple","",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(g.Sb(0,"mat-form-field",0),g.Sb(1,"mat-label"),g.yc(2,"Ausstattung"),g.Rb(),g.Sb(3,"mat-select",1),g.wc(4,H,2,2,"mat-option",2),g.ec(5,"keyvalue"),g.Rb(),g.Rb()),2&t&&(g.Ab(3),g.jc("formControl",e.control),g.Ab(1),g.jc("ngForOf",g.fc(5,2,e.accessories)))},directives:[G.c,T.a,G.f,B.a,a.k,a.d,N.l,P.l],pipes:[N.g],styles:[""]}),t})();var W=n("pD6V"),q=n("qFsG"),V=n("iadO");function K(t,e){1&t&&(g.Sb(0,"mat-error"),g.yc(1,"Datumsformat ist nicht korrekt!"),g.Rb())}function J(t,e){1&t&&(g.Sb(0,"mat-error"),g.yc(1," Tag ist au\xdferhalb des m\xf6glichen Buchungszeitrum "),g.Rb())}let X=(()=>{class t{constructor(t){this.mediaObserver=t,t.isActive("xs"),this.minDate=new Date,this.maxDate=new Date,this.maxDate.setDate(this.maxDate.getDate()+7)}ngOnInit(){}get isHandset(){return this.mediaObserver.isActive("xs")}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(W.g))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-date-select"]],inputs:{control:"control"},decls:9,vars:8,consts:[["fxFlex",""],["matInput","","required","",3,"max","min","matDatepicker","formControl","focus"],["matSuffix","",3,"for"],[3,"touchUi"],["picker",""],[4,"ngIf"]],template:function(t,e){if(1&t){const t=g.Tb();g.Sb(0,"mat-form-field",0),g.Sb(1,"mat-label"),g.yc(2,"Tag"),g.Rb(),g.Sb(3,"input",1),g.ac("focus",(function(){return g.nc(t),g.mc(6).open()})),g.Rb(),g.Nb(4,"mat-datepicker-toggle",2),g.Nb(5,"mat-datepicker",3,4),g.wc(7,K,2,0,"mat-error",5),g.wc(8,J,2,0,"mat-error",5),g.Rb()}if(2&t){const t=g.mc(6);g.Ab(3),g.jc("max",e.maxDate)("min",e.minDate)("matDatepicker",t)("formControl",e.control),g.Ab(1),g.jc("for",t),g.Ab(1),g.jc("touchUi",e.isHandset),g.Ab(2),g.jc("ngIf",e.control.hasError("matDatepickerParse")),g.Ab(1),g.jc("ngIf",e.control.hasError("matDatepickerMin"))}},directives:[G.c,T.a,G.f,q.b,V.b,a.b,a.p,a.k,a.d,V.d,G.g,V.a,N.m,G.b],styles:[""]}),t})();function Z(t,e){1&t&&(g.Sb(0,"mat-error"),g.yc(1,"Start-Zeitpunkt ist ben\xf6tigt"),g.Rb())}function Q(t,e){1&t&&(g.Sb(0,"mat-error"),g.yc(1,"End-Zeitpunkt ist ben\xf6tigt"),g.Rb())}let Y=(()=>{class t{constructor(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Gb({type:t,selectors:[["app-timespan-select"]],inputs:{controlFrom:"controlFrom",controlTo:"controlTo"},features:[g.zb([{provide:a.i,useExisting:Object(g.U)(()=>t),multi:!0}])],decls:7,vars:4,consts:[["fxLayout","row","fxLayoutGap","16px","fxLayout.lt-sm","column","fxLayoutGap.lt-sm","0px","fxFlex",""],["fxFlex",""],["placeholder","Von","matInput","","type","time","required","",3,"formControl"],[4,"ngIf"],["placeholder","Bis","matInput","","type","time","required","",3,"formControl"]],template:function(t,e){1&t&&(g.Sb(0,"div",0),g.Sb(1,"mat-form-field",1),g.Nb(2,"input",2),g.wc(3,Z,2,0,"mat-error",3),g.Rb(),g.Sb(4,"mat-form-field",1),g.Nb(5,"input",4),g.wc(6,Q,2,0,"mat-error",3),g.Rb(),g.Rb()),2&t&&(g.Ab(2),g.jc("formControl",e.controlFrom),g.Ab(1),g.jc("ngIf",e.controlTo.hasError("required")),g.Ab(2),g.jc("formControl",e.controlTo),g.Ab(1),g.jc("ngIf",e.controlTo.hasError("required")))},directives:[T.c,T.d,T.a,G.c,q.b,a.b,a.p,a.k,a.d,N.m,G.b],styles:[""]}),t})();var tt=n("+fDI"),et=n("znSr");let nt=(()=>{class t{transform(t,e=8){return t+e+" Uhr"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=g.Lb({name:"capacityTime",type:t,pure:!0}),t})();const ot=function(t){return[t,"capacity"]};function it(t,e){if(1&t&&(g.Qb(0),g.Sb(1,"span",3),g.Sb(2,"span",4),g.yc(3),g.ec(4,"capacityTime"),g.Rb(),g.Rb(),g.Pb()),2&t){const t=e.$implicit,n=e.index,o=g.dc();g.Ab(1),g.jc("ngClass",g.kc(5,ot,"capacity-"+t)),g.Ab(2),g.zc(g.gc(4,2,n,o.startHour))}}let rt=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Gb({type:t,selectors:[["app-capacity-view"]],inputs:{capacity:"capacity",startHour:"startHour",title:"title"},decls:3,vars:2,consts:[["fxLayout","row","fxLayoutAlign","start baseline",1,"wrapper"],[1,"label",3,"innerHTML"],[4,"ngFor","ngForOf"],[3,"ngClass"],["ngClass.lt-sm","hour-small",1,"hour"]],template:function(t,e){1&t&&(g.Sb(0,"div",0),g.Nb(1,"label",1),g.wc(2,it,5,7,"ng-container",2),g.Rb()),2&t&&(g.Ab(1),g.jc("innerHTML",e.title,g.oc),g.Ab(1),g.jc("ngForOf",e.capacity))},directives:[T.c,T.b,N.l,N.k,et.a],pipes:[nt],styles:[".wrapper[_ngcontent-%COMP%]{margin-bottom:32px;border-bottom:1px solid #8b8b8b}[_nghost-%COMP%]{height:74px;display:flex;flex-direction:column;justify-content:flex-end;position:relative}.label[_ngcontent-%COMP%]{position:absolute;color:rgba(0,0,0,.54);font-size:12px;font-weight:400;top:0}.capacity[_ngcontent-%COMP%]{display:block;flex:1 1 auto;margin:0 1px;position:relative;justify-content:center;display:flex}.hour[_ngcontent-%COMP%]{position:absolute;bottom:-18px;font-size:.6rem}.hour-small[_ngcontent-%COMP%]{transform:rotate(45deg);white-space:nowrap;bottom:-27px;margin-left:10px}.capacity-0[_ngcontent-%COMP%]{height:2px;background:rgba(216,65,62,.2)}.capacity-1[_ngcontent-%COMP%]{height:10px;background:rgba(216,65,62,.5)}.capacity-2[_ngcontent-%COMP%]{height:20px;background:#b02f2c}"]}),t})();var at=n("UT+O");const ct=["institutionSelect"];function st(t,e){if(1&t&&g.Ob(0,7),2&t){g.dc();const t=g.mc(11);g.jc("ngTemplateOutlet",t)}}const lt=function(t){return{bookingInfo:t}};function ut(t,e){if(1&t&&g.Ob(0,8),2&t){const t=e.ngIf;g.dc();const n=g.mc(7);g.jc("ngTemplateOutlet",n)("ngTemplateOutletContext",g.kc(2,lt,t))}}function bt(t,e){if(1&t&&(g.Nb(0,"app-capacity-view",17),g.ec(1,"date")),2&t){const t=e.ngIf,n=g.dc(2);g.jc("capacity",t[n.capacityForDay])("startHour",t.startHour)("title","Auslastung ("+g.gc(1,3,n.bookingFormGroup.get("from_date").value,"dd.MM")+")")}}function pt(t,e){if(1&t){const t=g.Tb();g.Sb(0,"div",9),g.Nb(1,"app-opening-hours",10),g.Nb(2,"br"),g.Nb(3,"app-area-select",11),g.Nb(4,"app-accessories-select",12),g.Nb(5,"app-date-select",12),g.wc(6,bt,2,6,"app-capacity-view",13),g.ec(7,"async"),g.Nb(8,"app-timespan-select",14),g.Sb(9,"div",15),g.Sb(10,"app-loading-button",16),g.ac("click",(function(){g.nc(t);const e=g.dc();return e.bookingFormGroup.markAllAsTouched(),e.bookingFormGroup.valid&&e.book()})),g.yc(11," Buchen "),g.Rb(),g.Rb(),g.Rb()}if(2&t){const t=e.bookingInfo,n=g.dc();g.jc("formGroup",n.bookingFormGroup),g.Ab(1),g.jc("intervals",t.timeslots.interval),g.Ab(2),g.jc("control",n.bookingFormGroup.get("area"))("areas",t.areas),g.Ab(1),g.jc("control",n.bookingFormGroup.get("fitting")),g.Ab(1),g.jc("control",n.bookingFormGroup.get("from_date")),g.Ab(1),g.jc("ngIf",g.fc(7,10,n.capacity$)),g.Ab(2),g.jc("controlFrom",n.bookingFormGroup.get("from_time"))("controlTo",n.bookingFormGroup.get("until_time")),g.Ab(2),g.jc("loading",n.inBookingProcess)}}function gt(t,e){1&t&&g.Nb(0,"bullet-list-content-loader")}function ft(t,e){if(1&t&&(g.Sb(0,"div"),g.wc(1,gt,1,0,"bullet-list-content-loader",18),g.Rb()),2&t){const t=g.dc();g.Ab(1),g.jc("ngIf",t.isInstitutionSelected)}}function dt(t,e){1&t&&(g.Sb(0,"p"),g.yc(1,"Bitte w\xe4hle einen Standort"),g.Rb())}let mt=(()=>{class t{constructor(t,e,n,o,i,r){this.institutionService=t,this.prefService=e,this.bookingService=n,this.workloadService=o,this.fb=i,this.router=r,this.inBookingProcess=!1,this.institutions$=this.institutionService.getInstitutions();const c=this.prefService.getPreferedInstitution();this.bookingFormGroup=this.fb.group({institution:[c],area:["no selection",a.q.required],fitting:[[]],from_date:[new Date,a.q.required],from_time:[null,a.q.required],until_time:[null,a.q.required]})}ngOnInit(){this.bookingFormGroup.get("institution").valueChanges.subscribe(this.institutionSelected.bind(this)),this.bookingFormGroup.get("from_date").valueChanges.subscribe(this.calcCapacityDay.bind(this)),this.prefService.getPreferedInstitution()&&this.institutionSelected(this.prefService.getPreferedInstitution())}institutionSelected(t){return Object(r.a)(this,void 0,void 0,(function*(){this.prefService.getPreferedSeat(t,this.bookingFormGroup),this.prefService.setPreferedInstitution(t),this.capacity$=this.workloadService.getWorkload(t),this.bookingInfo$=Object(c.a)([this.institutionService.getTimesolts(t),this.institutionService.getAreas(t)]).pipe(Object(s.a)(([t,e])=>({areas:e,timeslots:t})))}))}book(){const t=this.bookingFormGroup.getRawValue();this.prefService.setPreferedSeat(t.institution,this.bookingFormGroup),this.inBookingProcess=!0,this.bookingService.book({area:t.area,from_date:this.convertDate(t.from_date),from_time:t.from_time,until_time:t.until_time,institution:t.institution,fitting:t.fitting}).subscribe({next:t=>{const e="/"+i.a.BOOKING_INFO.replace(":id",t.bookingCode);this.router.navigateByUrl(e)},error:t=>{this.inBookingProcess=!1}})}convertDate(t){return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}get isInstitutionSelected(){return!!this.bookingFormGroup.get("institution").value}calcCapacityDay(){const t=new Date,e=this.bookingFormGroup.get("from_date").value.getTime()-t.getTime();this.capacityForDay=Math.ceil(e/864e5)}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(w),g.Mb(A),g.Mb(F),g.Mb(C),g.Mb(a.c),g.Mb(o.b))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-booking"]],viewQuery:function(t,e){var n;1&t&&g.sc(ct,!0),2&t&&g.lc(n=g.bc())&&(e.institutionSelect=n.first)},decls:12,vars:9,consts:[["fxLayout","column",1,"booking-form",3,"formGroup"],["formControlName","institution",3,"institutions"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf","ngIfElse"],["seatSelect",""],["loading",""],["pleaseSelectHint",""],[3,"ngTemplateOutlet"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["fxLayout","column","fxLayoutGap","0px",3,"formGroup"],[3,"intervals"],[3,"control","areas"],[3,"control"],[3,"capacity","startHour","title",4,"ngIf"],[3,"controlFrom","controlTo"],["fxLayout","row","fxLayoutAlign","end center"],[3,"loading","click"],[3,"capacity","startHour","title"],[4,"ngIf"]],template:function(t,e){if(1&t&&(g.Sb(0,"form",0),g.Nb(1,"app-institution-select",1),g.ec(2,"async"),g.wc(3,st,1,1,"ng-container",2),g.wc(4,ut,1,4,"ng-container",3),g.ec(5,"async"),g.Rb(),g.wc(6,pt,12,12,"ng-template",null,4,g.xc),g.wc(8,ft,2,1,"ng-template",null,5,g.xc),g.wc(10,dt,2,0,"ng-template",null,6,g.xc)),2&t){const t=g.mc(9);g.jc("formGroup",e.bookingFormGroup),g.Ab(1),g.jc("institutions",g.fc(2,5,e.institutions$)),g.Ab(2),g.jc("ngIf",!e.isInstitutionSelected),g.Ab(1),g.jc("ngIf",g.fc(5,7,e.isInstitutionSelected&&e.bookingInfo$))("ngIfElse",t)}},directives:[a.r,a.l,T.c,a.f,M,a.k,a.e,N.m,N.r,T.d,E,z,U,X,Y,T.b,tt.a,rt,at.a],pipes:[N.b,N.e],styles:[""],data:{animation:[l.a]}}),Object(r.b)([p()],t.prototype,"book",null),t})();var ht=n("oj5B");let kt=(()=>{class t{constructor(t,e,n,o){this.bookingService=e,this.router=n,this.snackbar=o,this.cancelationInProgress=!1,this.cancelationFormGroup=t.group({code:["",a.q.required]})}ngOnInit(){}cancel(){}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(a.c),g.Mb(F),g.Mb(o.b),g.Mb(S.a))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-cancelation-with-code"]],decls:6,vars:3,consts:[["fxLayout","column",3,"formGroup","submit"],["matInput","","formControlName","code","placeholder","Buchungscode"],["fxLayout","row","fxLayoutAlign","end center"],[3,"disabled","loading","click"]],template:function(t,e){1&t&&(g.Sb(0,"form",0),g.ac("submit",(function(){return e.cancel()})),g.Sb(1,"mat-form-field"),g.Nb(2,"input",1),g.Rb(),g.Sb(3,"div",2),g.Sb(4,"app-loading-button",3),g.ac("click",(function(){return e.cancel()})),g.yc(5," Stornieren "),g.Rb(),g.Rb(),g.Rb()),2&t&&(g.jc("formGroup",e.cancelationFormGroup),g.Ab(4),g.jc("disabled",e.cancelationFormGroup.invalid)("loading",e.cancelationInProgress))},directives:[a.r,a.l,T.c,a.f,G.c,q.b,a.b,a.k,a.e,T.b,tt.a],styles:[""]}),t})();var St=n("0IaG"),vt=n("bTqV");let yt=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Gb({type:t,selectors:[["app-confirm-cancelation"]],decls:7,vars:2,consts:[["align","end","fxLayoutGap","8px"],["mat-flat-button","",3,"mat-dialog-close"],[3,"mat-dialog-close"]],template:function(t,e){1&t&&(g.Sb(0,"p"),g.yc(1,"Wollen Sie die Buchung wirklich stornieren?"),g.Rb(),g.Sb(2,"mat-dialog-actions",0),g.Sb(3,"button",1),g.yc(4,"Nein"),g.Rb(),g.Sb(5,"app-loading-button",2),g.yc(6,"Ja"),g.Rb(),g.Rb()),2&t&&(g.Ab(3),g.jc("mat-dialog-close",!1),g.Ab(2),g.jc("mat-dialog-close",!0))},directives:[St.b,T.d,vt.a,St.c,tt.a],styles:[""]}),t})();var wt=n("NFeN");function At(t,e){if(1&t){const t=g.Tb();g.Sb(0,"table"),g.Nb(1,"br"),g.Sb(2,"tr"),g.Sb(3,"td"),g.yc(4,"Arbeitsplatz:"),g.Rb(),g.Sb(5,"td"),g.yc(6),g.Rb(),g.Rb(),g.Nb(7,"br"),g.Sb(8,"tr"),g.Sb(9,"td"),g.yc(10,"Standort:"),g.Rb(),g.Sb(11,"td"),g.yc(12),g.Rb(),g.Rb(),g.Sb(13,"tr"),g.Sb(14,"td"),g.yc(15,"Zeit:"),g.Rb(),g.Sb(16,"td"),g.yc(17),g.ec(18,"date"),g.ec(19,"date"),g.Rb(),g.Rb(),g.Sb(20,"tr"),g.Sb(21,"td"),g.yc(22,"Tag:"),g.Rb(),g.Sb(23,"td"),g.yc(24),g.ec(25,"date"),g.Rb(),g.Rb(),g.Nb(26,"br"),g.Sb(27,"tr"),g.Sb(28,"td"),g.yc(29,"Buchungs-nummer:"),g.Rb(),g.Sb(30,"td"),g.yc(31),g.Rb(),g.Rb(),g.Nb(32,"br"),g.Sb(33,"tr"),g.Sb(34,"td",3),g.Sb(35,"div",4),g.Sb(36,"app-loading-button",5),g.ac("click",(function(){g.nc(t);const n=e.ngIf;return g.dc().cancelBooking(n)})),g.yc(37," Stornieren "),g.Rb(),g.Rb(),g.Rb(),g.Rb(),g.Rb()}if(2&t){const t=e.ngIf,n=g.dc();g.Ab(6),g.zc(t.id),g.Ab(6),g.zc(t.institution),g.Ab(5),g.Bc("",g.gc(18,7,t.start,"HH:mm")," - ",g.gc(19,10,t.end,"HH:mm"),""),g.Ab(7),g.zc(g.gc(25,13,t.start,"longDate")),g.Ab(7),g.zc(t.bookingCode),g.Ab(5),g.jc("loading",n.cancelationInProgress)}}function It(t,e){1&t&&g.Nb(0,"bullet-list-content-loader")}let Ot=(()=>{class t{constructor(t,e,n,o,r){this.bookingService=t,this.activeRoute=e,this.router=n,this.dialog=o,this.datePipe=r,this.bookingListRoute="/"+i.a.BOOKING_LIST}ngOnInit(){this.booking$=this.activeRoute.params.pipe(Object(R.a)(t=>this.bookingService.getBooking(t.id)))}cancelBooking(t){this.dialog.open(yt).afterClosed().subscribe(e=>{e&&(this.cancelationInProgress=!0,this.bookingService.cancelBooking(t.bookingCode,this.datePipe.transform(t.start,"HH:mm"),this.datePipe.transform(t.end,"HH:mm")).subscribe(()=>{this.cancelationInProgress=!1,this.router.navigate(["/",i.a.BOOKING_LIST])}))})}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(F),g.Mb(o.a),g.Mb(o.b),g.Mb(St.a),g.Mb(N.e))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-booking-information"]],decls:7,vars:5,consts:[["mat-button","",1,"back-button",3,"routerLink"],[4,"ngIf","ngIfElse"],["loading",""],["colspan","2"],["fxLayout","row","fxLayoutAlign","end center"],[3,"loading","click"]],template:function(t,e){if(1&t&&(g.Sb(0,"button",0),g.Sb(1,"mat-icon"),g.yc(2,"close"),g.Rb(),g.Rb(),g.wc(3,At,38,16,"table",1),g.ec(4,"async"),g.wc(5,It,1,0,"ng-template",null,2,g.xc)),2&t){const t=g.mc(6);g.jc("routerLink",e.bookingListRoute),g.Ab(3),g.jc("ngIf",g.fc(4,3,e.booking$))("ngIfElse",t)}},directives:[vt.a,o.c,wt.a,N.m,T.c,T.b,tt.a,at.a],pipes:[N.b,N.e],styles:[".back-button[_ngcontent-%COMP%]{width:34px;height:34px;padding:0;min-width:unset;line-height:unset;position:absolute;right:16px}table[_ngcontent-%COMP%]{width:100%}"]}),t})();var Rt=n("MutI");function xt(t,e){if(1&t&&(g.Sb(0,"a",9),g.Sb(1,"div",10),g.Sb(2,"span",11),g.Sb(3,"span",12),g.yc(4),g.Rb(),g.Sb(5,"span",13),g.yc(6),g.Rb(),g.Rb(),g.Sb(7,"span",14),g.yc(8),g.ec(9,"date"),g.Rb(),g.Sb(10,"span",14),g.yc(11),g.ec(12,"date"),g.ec(13,"date"),g.Rb(),g.Rb(),g.Rb()),2&t){const t=e.$implicit,n=g.dc(3);g.jc("routerLink",n.getLink(t.bookingCode)),g.Ab(4),g.Ac("",t.institution,": "),g.Ab(2),g.Ac(" Platz ",t.id," "),g.Ab(2),g.Ac(" ",g.gc(9,6,t.start,"dd MMM"),""),g.Ab(3),g.Bc(" ",g.gc(12,9,t.start,"HH:mm")," - ",g.gc(13,12,t.end,"HH:mm")," ")}}function jt(t,e){if(1&t&&(g.Qb(0),g.wc(1,xt,14,15,"a",8),g.Pb()),2&t){const t=g.dc().ngIf;g.Ab(1),g.jc("ngForOf",t)}}function Ft(t,e){if(1&t&&(g.Sb(0,"mat-list",6),g.wc(1,jt,2,1,"ng-container",7),g.Rb()),2&t){const t=e.ngIf;g.dc();const n=g.mc(7);g.Ab(1),g.jc("ngIf",t.length)("ngIfElse",n)}}function Ct(t,e){1&t&&(g.Sb(0,"span"),g.yc(1,"Keine Buchungen gefunden"),g.Rb())}function Tt(t,e){1&t&&g.Nb(0,"bullet-list-content-loader")}let Gt=(()=>{class t{constructor(t){this.bookingService=t,this.bookings$=this.bookingService.getBookings()}getLink(t){return"/"+i.a.BOOKING_INFO.replace(":id",t)}get cancelationRoute(){return"/"+i.a.CANCELATION}ngOnInit(){}reload(){this.bookingService.reloadBookings()}}return t.\u0275fac=function(e){return new(e||t)(g.Mb(F))},t.\u0275cmp=g.Gb({type:t,selectors:[["app-booking-list"]],decls:10,vars:4,consts:[[3,"swipeDown"],["role","list",4,"ngIf","ngIfElse"],["fxLayoutAlign","end center"],["mat-button","",3,"click"],["noBookings",""],["loading",""],["role","list"],[4,"ngIf","ngIfElse"],["mat-list-item","","role","listitem",3,"routerLink",4,"ngFor","ngForOf"],["mat-list-item","","role","listitem",3,"routerLink"],["fxLayout","row","fxFlex","","fxLayoutGap","16px","fxLayoutAlign","start center",2,"width","100%"],["fxFlex","1 1 auto",2,"overflow","hidden","white-space","break-spaces"],[2,"white-space","nowrap","overflow","hidden"],[2,"white-space","nowrap"],["fxFlex","0 0 auto"]],template:function(t,e){if(1&t&&(g.Sb(0,"div",0),g.ac("swipeDown",(function(){return e.reload()})),g.wc(1,Ft,2,2,"mat-list",1),g.ec(2,"async"),g.Sb(3,"div",2),g.Sb(4,"button",3),g.ac("click",(function(){return e.reload()})),g.yc(5,"Aktualisieren"),g.Rb(),g.Rb(),g.Rb(),g.wc(6,Ct,2,0,"ng-template",null,4,g.xc),g.wc(8,Tt,1,0,"ng-template",null,5,g.xc)),2&t){const t=g.mc(9);g.Ab(1),g.jc("ngIf",g.fc(2,2,e.bookings$))("ngIfElse",t)}},directives:[N.m,T.b,vt.a,Rt.a,N.l,Rt.b,o.e,T.c,T.a,T.d,at.a],pipes:[N.b,N.e],styles:["a[_ngcontent-%COMP%]{border-bottom:1px solid #f1f1f1}a[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.mat-list-base[_ngcontent-%COMP%]{padding-top:0}"]}),t})(),Bt=(()=>{class t{}return t.\u0275mod=g.Kb({type:t}),t.\u0275inj=g.Jb({factory:function(e){return new(e||t)},imports:[[o.f.forChild([{path:i.a.BOOKING,component:mt,data:{title:["Arbeitsplatz buchen"]},canActivate:[ht.a]},{path:i.a.CANCELATION,component:kt,data:{title:["Buchungen","Stornieren"]},canActivate:[ht.a]},{path:i.a.BOOKING_INFO,component:Ot,data:{title:["Buchungen","Buchung"]},canActivate:[ht.a]},{path:i.a.BOOKING_LIST,component:Gt,data:{title:["Buchungen"]},canActivate:[ht.a]}])]]}),t})()}}]);