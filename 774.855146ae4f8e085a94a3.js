(self.webpackChunkubl_booking=self.webpackChunkubl_booking||[]).push([[774],{3774:(t,e,n)=>{"use strict";n.r(e),n.d(e,{PrivateRoutingModule:()=>Ut});var o=n(4655),i=n(2398),r=n(4762),s=n(3679),a=n(9112),c=n(8002),u=n(4e3),l=n(935),p=n(3038),g=n(7716),h=n(1841),f=n(2340),m=n(9643),d=n(5304),b=n(205),k=n(6458),Z=n(7878);let x=(()=>{class t{constructor(t,e,n){this.snackbar=t,this.router=e,this.authService=n}catchInstitutionsError(){return(0,d.K)(t=>(this.snackbarWithLogout(),(0,b._)(t)))}catchAreasError(){return(0,d.K)(t=>(this.snackbarWithLogout(),(0,b._)(t)))}catchTimeslotsError(){return(0,d.K)(t=>(this.snackbarWithLogout(),(0,b._)(t)))}catchBookingError(){return(0,d.K)(t=>{if("sessionerror"===t.message)throw this.snackbarWithLogout("Ihre Session ist abgelaufen!"),new Error(t.message);return this.snackbar.open({"":"Es konnte kein Arbeitsplatz zu diesen Bedingungen gefunden werden",concurrently_booking:"Sie haben breits einen Arbeitsplatz zu dieser Zeit",server_error:"Unbekannter Fehler (Versuchen Sie sich ab und wieder anzumelden)",outofreach:"Sie k\xf6nnen nur innerhalb der n\xe4chsten 7 Tage buchen!",outofdate:"Der Buchungszeitrum ist au\xdferhalb der \xd6ffnungszeiten",notbookable2:"Die Bibliothek ist vom 03.08 bis 14.08. geschlossen!",notbookable3:"Die Bibliothek ist ab dem 03.08.2020 nur bis 16 Uhr ge\xf6ffnet!",outoftime:"Der Buchungszeitrum ist au\xdferhalb der \xd6ffnungszeiten",concurrent_error:"Fehler bei der Buchung, bitte versuchen Sie es erneut!"}[null==t?void 0:t.message]||"Unbekannter Fehler","Ok",{duration:5e3}),(0,b._)(t)})}snackbarWithLogout(t="Fehler beim Laden! Bitte melden Sie sich erneut an.",e="Anmelden"){this.snackbar.open(t,e,{duration:-1}).afterDismissed().subscribe(()=>{this.authService.logout()})}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(k.ux),g.LFG(o.F0),g.LFG(Z.e))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),v=(()=>{class t{constructor(t,e){this.http=t,this.errorSerivce=e,this.institutionApi=f.N.api.basePath+f.N.api.institution,this.timeslotsApi=f.N.api.basePath+f.N.api.timeslots,this.areasApi=f.N.api.basePath+f.N.api.areas}getInstitutions(){return this.http.get(this.institutionApi,{responseType:"text"}).pipe((0,c.U)(t=>t.split("#")),this.errorSerivce.catchInstitutionsError(),(0,m.d)(1))}getTimesolts(t){const e=(new h.LE).set("institution",t);return this.http.get(this.timeslotsApi,{params:e}).pipe(this.errorSerivce.catchTimeslotsError())}getAreas(t){const e=(new h.LE).set("institution",t);return this.http.get(this.areasApi,{params:e,responseType:"text"}).pipe(this.errorSerivce.catchAreasError(),(0,c.U)(t=>t.split("#")))}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(h.eN),g.LFG(x))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),A=(()=>{class t{constructor(t){this.authService=t}getPreferedInstitution(){return localStorage.getItem(this.authService.getReaderNumber()+":institution")}setPreferedInstitution(t){return localStorage.setItem(this.authService.getReaderNumber()+":institution",t)}getPreferedSeat(t,e){const n=e.getRawValue(),o=JSON.parse(localStorage.getItem(this.authService.getReaderNumber()+t+":seat")||"{}");e.get("area").setValue(o.area||"no selection"),e.get("fitting").setValue(o.fitting||[]),e.get("from_date").setValue(n.from_date||new Date),e.get("from_time").setValue(n.from_time||o.from_time||`${(new Date).getHours()+1}:00`),e.get("until_time").setValue(n.until_time||o.until_time||null)}setPreferedSeat(t,e){const n=Object.assign({},e.getRawValue());localStorage.setItem(this.authService.getReaderNumber()+t+":seat",JSON.stringify(n))}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(Z.e))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var T=n(6215),y=n(5917),w=n(9773),_=n(8307),S=n(3190);let I=(()=>{class t{constructor(t,e,n,o){this.http=t,this.authService=e,this.snackbar=n,this.errorService=o,this.bookingApi=f.N.api.basePath+f.N.api.booking,this.bookingsApi=f.N.api.basePath+f.N.api.bookings,this.stornoApi=f.N.api.basePath+f.N.api.strono,this.updateBookings$=new T.X(null)}book(t){let e=new h.LE;return t.token=this.authService.getToken(),t.readernumber=this.authService.getReaderNumber(),Object.keys(t).forEach(n=>{"fitting"===n?t[n].forEach(t=>{e=e.append("fitting",t)}):e=e.set(n,t[n])}),e=e.append("tslot","0"),e=e.append("preference","0"),this.http.post(this.bookingApi,e.toString(),{headers:(new h.WM).set("Content-Type","application/x-www-form-urlencoded")}).pipe((0,c.U)(t=>{if(!t||""===t.bookingCode)throw new Error(t.message);return t}),this.errorService.catchBookingError(),(0,w.zg)(t=>this.authService.refreshToken().pipe((0,c.U)(e=>t))),(0,_.b)(()=>this.updateBookings$.next()))}cancelBooking(t,e,n){const o=(new h.LE).set("readernumber",this.authService.getReaderNumber()).set("token",this.authService.getAdminToken()).set("from",e).set("until",n).set("bookingcode",t);return console.log(o.toString(),e,n),this.http.post(this.stornoApi,o.toString(),{headers:(new h.WM).set("Content-Type","application/x-www-form-urlencoded")}).pipe((0,c.U)(t=>(this.snackbar.open(t.message,null,{duration:5e3}),"Ihre Buchung wurde gel\xf6scht."===t.message)),(0,w.zg)(t=>this.authService.refreshToken().pipe((0,c.U)(e=>t))),(0,_.b)(()=>this.updateBookings$.next()),(0,d.K)(t=>(0,y.of)(!1)))}getBookings(){return this.bookingCache$||(this.bookingCache$=this.updateBookings$.pipe((0,S.w)(()=>this.http.post(this.bookingsApi,JSON.stringify({token:this.authService.getAdminToken(),readernumber:this.authService.getReaderNumber()}),{headers:(new h.WM).set("Content-Type","application/x-www-form-urlencoded")}).pipe((0,w.zg)(t=>t&&t.bookings?(0,y.of)(t.bookings):this.authService.refreshToken().pipe((0,c.U)(()=>[]))))),(0,m.d)(1))),this.bookingCache$}getBooking(t){return this.getBookings().pipe((0,c.U)(e=>e.find(e=>e.bookingCode===t)))}reloadBookings(){this.updateBookings$.next()}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(h.eN),g.LFG(Z.e),g.LFG(k.ux),g.LFG(x))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),q=(()=>{class t{constructor(t){this.http=t,this.workloadApi=f.N.api.basePath+f.N.api.workload}getWorkload(t){const e=(new h.LE).set("institution",t);return this.http.get(this.workloadApi,{params:e,responseType:"text"}).pipe(this.workloadParser())}workloadParser(){return(0,c.U)(t=>{const e=[],n="<th>(.*?) Uhr</th>",o=Number.parseInt(new RegExp(n).exec(t)[1],10),i=t.match(new RegExp(n,"g")).length;e.startHour=o,e.hours=i;const r=t.match(new RegExp("<td style='background-color:(.*?)'>","g")).map(t=>/<td style='background-color:(.*?)'>/.exec(t)[1]);for(let s=0;s<8;s++){const t=[];for(let e=0;e<i;e++)t.push({green:0,yellow:1,red:2}[r[8*e+s]]);e.push(t)}return e})}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(h.eN))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var O=n(5618),F=n(8295),U=n(7441),J=n(8583),N=n(2458);function L(t,e){if(1&t&&(g.TgZ(0,"mat-option",4),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.Q6J("value",t),g.xp6(1),g.hij(" ",t," ")}}let C=(()=>{class t{constructor(){}get selectedInstitution(){return this.institution}set selectedInstitution(t){this.institution=t,this.onChange&&this.onChange(t),this.onTouch&&this.onTouch()}writeValue(t){this.institution=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}setDisabledState(t){this.isDisabled=t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-institution-select"]],inputs:{institutions:"institutions"},features:[g._Bn([{provide:s.JU,useExisting:(0,g.Gpc)(()=>t),multi:!0}])],decls:6,vars:3,consts:[["fxFlex",""],["required","",3,"ngModel","disabled","ngModelChange"],["institutionSelect",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(g.TgZ(0,"mat-form-field",0),g.TgZ(1,"mat-label"),g._uU(2,"Standort"),g.qZA(),g.TgZ(3,"mat-select",1,2),g.NdJ("ngModelChange",function(t){return e.selectedInstitution=t}),g.YNc(5,L,2,2,"mat-option",3),g.qZA(),g.qZA()),2&t&&(g.xp6(3),g.Q6J("ngModel",e.selectedInstitution)("disabled",e.isDisabled),g.xp6(2),g.Q6J("ngForOf",e.institutions))},directives:[F.KE,O.yH,F.hX,U.gD,s.Q7,s.JJ,s.On,J.sg,N.ey],styles:[""]}),t})(),Q=(()=>{class t{constructor(){this.days={1:"Sonntag",2:"Montag",3:"Dienstag",4:"Mittwoch",5:"Donnerstag",6:"Freitag",7:"Samstag"}}transform(t,...e){return this.getDayAsString(t.day)+t.from+" Uhr - "+t.until+" Uhr"}getDayAsString(t){return t?this.days[t]+": ":""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=g.Yjl({name:"timeslotInterval",type:t,pure:!0}),t})();function B(t,e){if(1&t&&(g.TgZ(0,"div"),g._uU(1),g.ALo(2,"timeslotInterval"),g.qZA()),2&t){const t=e.$implicit;g.xp6(1),g.hij(" ",g.lcZ(2,1,t)," ")}}let G=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-opening-hours"]],inputs:{intervals:"intervals"},decls:5,vars:1,consts:[["fxLayout","row","fxLayoutGap","16px"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"span"),g._uU(2,"\xd6ffnungszeiten:"),g.qZA(),g.TgZ(3,"div"),g.YNc(4,B,3,3,"div",1),g.qZA(),g.qZA()),2&t&&(g.xp6(4),g.Q6J("ngForOf",e.intervals))},directives:[O.xw,O.SQ,J.sg],pipes:[Q],styles:[""]}),t})();function E(t,e){if(1&t&&(g.TgZ(0,"mat-option",2),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.Q6J("value",t),g.xp6(1),g.hij(" ",t," ")}}let P=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-area-select"]],inputs:{control:"control",areas:"areas"},decls:7,vars:3,consts:[["fxFlex",""],[3,"formControl"],[3,"value"],[3,"value",4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(g.TgZ(0,"mat-form-field",0),g.TgZ(1,"mat-label"),g._uU(2,"Bereich"),g.qZA(),g.TgZ(3,"mat-select",1),g.TgZ(4,"mat-option",2),g._uU(5," Alle Bereiche "),g.qZA(),g.YNc(6,E,2,2,"mat-option",3),g.qZA(),g.qZA()),2&t&&(g.xp6(3),g.Q6J("formControl",e.control),g.xp6(1),g.Q6J("value","no selection"),g.xp6(2),g.Q6J("ngForOf",e.areas))},directives:[F.KE,O.yH,F.hX,U.gD,s.JJ,s.oH,N.ey,J.sg],styles:[""]}),t})();function Y(t,e){if(1&t&&(g.TgZ(0,"mat-option",3),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.Q6J("value",t.key),g.xp6(1),g.hij(" ",t.value," ")}}let M=(()=>{class t{constructor(){this.accessories={"mit Strom":"mit Stromanschluss",PC:"mit PC","kein PC":"ohne PC",LAN:"mit LAN-Anschluss",Steharbeitsplatz:"Steharbeitsplatz"}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-accessories-select"]],inputs:{control:"control"},decls:6,vars:4,consts:[["fxFlex",""],["multiple","",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(g.TgZ(0,"mat-form-field",0),g.TgZ(1,"mat-label"),g._uU(2,"Ausstattung"),g.qZA(),g.TgZ(3,"mat-select",1),g.YNc(4,Y,2,2,"mat-option",2),g.ALo(5,"keyvalue"),g.qZA(),g.qZA()),2&t&&(g.xp6(3),g.Q6J("formControl",e.control),g.xp6(1),g.Q6J("ngForOf",g.lcZ(5,2,e.accessories)))},directives:[F.KE,O.yH,F.hX,U.gD,s.JJ,s.oH,J.sg,N.ey],pipes:[J.Nd],styles:[""]}),t})();var D=n(7736),H=n(9983),$=n(3220);function R(t,e){1&t&&(g.TgZ(0,"mat-error"),g._uU(1,"Datumsformat ist nicht korrekt!"),g.qZA())}function z(t,e){1&t&&(g.TgZ(0,"mat-error"),g._uU(1," Tag ist au\xdferhalb des m\xf6glichen Buchungszeitrum "),g.qZA())}let W=(()=>{class t{constructor(t){this.mediaObserver=t,t.isActive("xs"),this.minDate=new Date,this.maxDate=new Date,this.maxDate.setDate(this.maxDate.getDate()+7)}ngOnInit(){}get isHandset(){return this.mediaObserver.isActive("xs")}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(D.u0))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-date-select"]],inputs:{control:"control"},decls:9,vars:8,consts:[["fxFlex",""],["matInput","","required","",3,"max","min","matDatepicker","formControl","focus"],["matSuffix","",3,"for"],[3,"touchUi"],["picker",""],[4,"ngIf"]],template:function(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"mat-form-field",0),g.TgZ(1,"mat-label"),g._uU(2,"Tag"),g.qZA(),g.TgZ(3,"input",1),g.NdJ("focus",function(){return g.CHM(t),g.MAs(6).open()}),g.qZA(),g._UZ(4,"mat-datepicker-toggle",2),g._UZ(5,"mat-datepicker",3,4),g.YNc(7,R,2,0,"mat-error",5),g.YNc(8,z,2,0,"mat-error",5),g.qZA()}if(2&t){const t=g.MAs(6);g.xp6(3),g.Q6J("max",e.maxDate)("min",e.minDate)("matDatepicker",t)("formControl",e.control),g.xp6(1),g.Q6J("for",t),g.xp6(1),g.Q6J("touchUi",e.isHandset),g.xp6(2),g.Q6J("ngIf",e.control.hasError("matDatepickerParse")),g.xp6(1),g.Q6J("ngIf",e.control.hasError("matDatepickerMin"))}},directives:[F.KE,O.yH,F.hX,H.Nt,$.hl,s.Fj,s.Q7,s.JJ,s.oH,$.nW,F.R9,$.Mq,J.O5,F.TO],styles:[""]}),t})();function K(t,e){1&t&&(g.TgZ(0,"mat-error"),g._uU(1,"Start-Zeitpunkt ist ben\xf6tigt"),g.qZA())}function j(t,e){1&t&&(g.TgZ(0,"mat-error"),g._uU(1,"End-Zeitpunkt ist ben\xf6tigt"),g.qZA())}let X=(()=>{class t{constructor(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-timespan-select"]],inputs:{controlFrom:"controlFrom",controlTo:"controlTo"},features:[g._Bn([{provide:s.JU,useExisting:(0,g.Gpc)(()=>t),multi:!0}])],decls:7,vars:4,consts:[["fxLayout","row","fxLayoutGap","16px","fxLayout.lt-sm","column","fxLayoutGap.lt-sm","0px","fxFlex",""],["fxFlex",""],["placeholder","Von","matInput","","type","time","required","",3,"formControl"],[4,"ngIf"],["placeholder","Bis","matInput","","type","time","required","",3,"formControl"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"mat-form-field",1),g._UZ(2,"input",2),g.YNc(3,K,2,0,"mat-error",3),g.qZA(),g.TgZ(4,"mat-form-field",1),g._UZ(5,"input",4),g.YNc(6,j,2,0,"mat-error",3),g.qZA(),g.qZA()),2&t&&(g.xp6(2),g.Q6J("formControl",e.controlFrom),g.xp6(1),g.Q6J("ngIf",e.controlTo.hasError("required")),g.xp6(2),g.Q6J("formControl",e.controlTo),g.xp6(1),g.Q6J("ngIf",e.controlTo.hasError("required")))},directives:[O.xw,O.SQ,O.yH,F.KE,H.Nt,s.Fj,s.Q7,s.JJ,s.oH,J.O5,F.TO],styles:[""]}),t})();var V=n(4628),tt=n(8030);let et=(()=>{class t{transform(t,e=8){return t+e+" Uhr"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=g.Yjl({name:"capacityTime",type:t,pure:!0}),t})();const nt=function(t){return[t,"capacity"]};function ot(t,e){if(1&t&&(g.ynx(0),g.TgZ(1,"span",3),g.TgZ(2,"span",4),g._uU(3),g.ALo(4,"capacityTime"),g.qZA(),g.qZA(),g.BQk()),2&t){const t=e.$implicit,n=e.index,o=g.oxw();g.xp6(1),g.Q6J("ngClass",g.VKq(5,nt,"capacity-"+t)),g.xp6(2),g.Oqu(g.xi3(4,2,n,o.startHour))}}let it=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-capacity-view"]],inputs:{capacity:"capacity",startHour:"startHour",title:"title"},decls:3,vars:2,consts:[["fxLayout","row","fxLayoutAlign","start baseline",1,"wrapper"],[1,"label",3,"innerHTML"],[4,"ngFor","ngForOf"],[3,"ngClass"],["ngClass.lt-sm","hour-small",1,"hour"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g._UZ(1,"label",1),g.YNc(2,ot,5,7,"ng-container",2),g.qZA()),2&t&&(g.xp6(1),g.Q6J("innerHTML",e.title,g.oJD),g.xp6(1),g.Q6J("ngForOf",e.capacity))},directives:[O.xw,O.Wh,J.sg,J.mk,tt.oO],pipes:[et],styles:[".wrapper[_ngcontent-%COMP%]{margin-bottom:32px;border-bottom:1px solid #8b8b8b}[_nghost-%COMP%]{height:74px;display:flex;flex-direction:column;justify-content:flex-end;position:relative}.label[_ngcontent-%COMP%]{position:absolute;color:#0000008a;font-size:12px;font-weight:400;top:0}.capacity[_ngcontent-%COMP%]{display:block;flex:1 1 auto;margin:0 1px;position:relative;justify-content:center;display:flex}.hour[_ngcontent-%COMP%]{position:absolute;bottom:-18px;font-size:.6rem}.hour-small[_ngcontent-%COMP%]{transform:rotate(45deg);white-space:nowrap;bottom:-27px;margin-left:10px}.capacity-0[_ngcontent-%COMP%]{height:2px;background:#d8413e33}.capacity-1[_ngcontent-%COMP%]{height:10px;background:#d8413e80}.capacity-2[_ngcontent-%COMP%]{height:20px;background:#b02f2c}"]}),t})();var rt=n(4648);const st=["institutionSelect"];function at(t,e){if(1&t&&g.GkF(0,7),2&t){g.oxw();const t=g.MAs(11);g.Q6J("ngTemplateOutlet",t)}}const ct=function(t){return{bookingInfo:t}};function ut(t,e){if(1&t&&g.GkF(0,8),2&t){const t=e.ngIf;g.oxw();const n=g.MAs(7);g.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",g.VKq(2,ct,t))}}function lt(t,e){if(1&t&&(g._UZ(0,"app-capacity-view",17),g.ALo(1,"date")),2&t){const t=e.ngIf,n=g.oxw(2);g.Q6J("capacity",t[n.capacityForDay])("startHour",t.startHour)("title","Auslastung ("+g.xi3(1,3,n.bookingFormGroup.get("from_date").value,"dd.MM")+")")}}function pt(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"div",9),g._UZ(1,"app-opening-hours",10),g._UZ(2,"br"),g._UZ(3,"app-area-select",11),g._UZ(4,"app-accessories-select",12),g._UZ(5,"app-date-select",12),g.YNc(6,lt,2,6,"app-capacity-view",13),g.ALo(7,"async"),g._UZ(8,"app-timespan-select",14),g.TgZ(9,"div",15),g.TgZ(10,"app-loading-button",16),g.NdJ("click",function(){g.CHM(t);const e=g.oxw();return e.bookingFormGroup.markAllAsTouched(),e.bookingFormGroup.valid&&e.book()}),g._uU(11," Buchen "),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=e.bookingInfo,n=g.oxw();g.Q6J("formGroup",n.bookingFormGroup),g.xp6(1),g.Q6J("intervals",t.timeslots.interval),g.xp6(2),g.Q6J("control",n.bookingFormGroup.get("area"))("areas",t.areas),g.xp6(1),g.Q6J("control",n.bookingFormGroup.get("fitting")),g.xp6(1),g.Q6J("control",n.bookingFormGroup.get("from_date")),g.xp6(1),g.Q6J("ngIf",g.lcZ(7,10,n.capacity$)),g.xp6(2),g.Q6J("controlFrom",n.bookingFormGroup.get("from_time"))("controlTo",n.bookingFormGroup.get("until_time")),g.xp6(2),g.Q6J("loading",n.inBookingProcess)}}function gt(t,e){1&t&&g._UZ(0,"bullet-list-content-loader")}function ht(t,e){if(1&t&&(g.TgZ(0,"div"),g.YNc(1,gt,1,0,"bullet-list-content-loader",18),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.Q6J("ngIf",t.isInstitutionSelected)}}function ft(t,e){1&t&&(g.TgZ(0,"p"),g._uU(1,"Bitte w\xe4hle einen Standort"),g.qZA())}class mt{constructor(t,e,n,o,i,r){this.institutionService=t,this.prefService=e,this.bookingService=n,this.workloadService=o,this.fb=i,this.router=r,this.inBookingProcess=!1,this.institutions$=this.institutionService.getInstitutions();const a=this.prefService.getPreferedInstitution();this.bookingFormGroup=this.fb.group({institution:[a],area:["no selection",s.kI.required],fitting:[[]],from_date:[new Date,s.kI.required],from_time:[null,s.kI.required],until_time:[null,s.kI.required]})}ngOnInit(){this.bookingFormGroup.get("institution").valueChanges.subscribe(this.institutionSelected.bind(this)),this.bookingFormGroup.get("from_date").valueChanges.subscribe(this.calcCapacityDay.bind(this)),this.prefService.getPreferedInstitution()&&this.institutionSelected(this.prefService.getPreferedInstitution())}institutionSelected(t){return(0,r.mG)(this,void 0,void 0,function*(){this.prefService.getPreferedSeat(t,this.bookingFormGroup),this.prefService.setPreferedInstitution(t),this.capacity$=this.workloadService.getWorkload(t),this.bookingInfo$=(0,a.aj)([this.institutionService.getTimesolts(t),this.institutionService.getAreas(t)]).pipe((0,c.U)(([t,e])=>({areas:e,timeslots:t})))})}book(){const t=this.bookingFormGroup.getRawValue();this.prefService.setPreferedSeat(t.institution,this.bookingFormGroup),this.inBookingProcess=!0,this.bookingService.book({area:t.area,from_date:this.convertDate(t.from_date),from_time:t.from_time,until_time:t.until_time,institution:t.institution,fitting:t.fitting}).subscribe({next:t=>{const e="/"+i.l.BOOKING_INFO.replace(":id",t.bookingCode);this.router.navigateByUrl(e)},error:t=>{this.inBookingProcess=!1}})}convertDate(t){return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`}get isInstitutionSelected(){return!!this.bookingFormGroup.get("institution").value}calcCapacityDay(){const t=new Date,e=this.bookingFormGroup.get("from_date").value.getTime()-t.getTime();this.capacityForDay=Math.ceil(e/864e5)}}mt.\u0275fac=function(t){return new(t||mt)(g.Y36(v),g.Y36(A),g.Y36(I),g.Y36(q),g.Y36(s.qu),g.Y36(o.F0))},mt.\u0275cmp=g.Xpm({type:mt,selectors:[["app-booking"]],viewQuery:function(t,e){if(1&t&&g.Gf(st,7),2&t){let t;g.iGM(t=g.CRH())&&(e.institutionSelect=t.first)}},decls:12,vars:9,consts:[["fxLayout","column",1,"booking-form",3,"formGroup"],["formControlName","institution",3,"institutions"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf","ngIfElse"],["seatSelect",""],["loading",""],["pleaseSelectHint",""],[3,"ngTemplateOutlet"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["fxLayout","column","fxLayoutGap","0px",3,"formGroup"],[3,"intervals"],[3,"control","areas"],[3,"control"],[3,"capacity","startHour","title",4,"ngIf"],[3,"controlFrom","controlTo"],["fxLayout","row","fxLayoutAlign","end center"],[3,"loading","click"],[3,"capacity","startHour","title"],[4,"ngIf"]],template:function(t,e){if(1&t&&(g.TgZ(0,"form",0),g._UZ(1,"app-institution-select",1),g.ALo(2,"async"),g.YNc(3,at,1,1,"ng-container",2),g.YNc(4,ut,1,4,"ng-container",3),g.ALo(5,"async"),g.qZA(),g.YNc(6,pt,12,12,"ng-template",null,4,g.W1O),g.YNc(8,ht,2,1,"ng-template",null,5,g.W1O),g.YNc(10,ft,2,0,"ng-template",null,6,g.W1O)),2&t){const t=g.MAs(9);g.Q6J("formGroup",e.bookingFormGroup),g.xp6(1),g.Q6J("institutions",g.lcZ(2,5,e.institutions$)),g.xp6(2),g.Q6J("ngIf",!e.isInstitutionSelected),g.xp6(1),g.Q6J("ngIf",g.lcZ(5,7,e.isInstitutionSelected&&e.bookingInfo$))("ngIfElse",t)}},directives:[s._Y,s.JL,O.xw,s.sg,C,s.JJ,s.u,J.O5,J.tP,O.SQ,G,P,M,W,X,O.Wh,V.v,it,rt.aF],pipes:[J.Ov,J.uU],styles:[""],data:{animation:[u.J]}}),(0,r.gn)([function(t={level:p.G.DEBUG,logReturn:!1,logError:!1}){return(e,n,o)=>{const i=o.value;return o.value=function(...o){const r=()=>`[LogMethodCall]: ${e.constructor.name}.${n}(${o}) `;l.R.log(t.level,r(),o);try{const e=i.apply(this,o);return t.logReturn&&l.R.log(t.level,`${r()} RETURNS: ${e}`,e),e}catch(s){throw t.logError&&l.R.log(t.level,`${r()} ERROR: ${s}`,s),s}},o}}()],mt.prototype,"book",null);var dt=n(912);let bt=(()=>{class t{constructor(t,e,n,o){this.bookingService=e,this.router=n,this.snackbar=o,this.cancelationInProgress=!1,this.cancelationFormGroup=t.group({code:["",s.kI.required]})}ngOnInit(){}cancel(){}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(s.qu),g.Y36(I),g.Y36(o.F0),g.Y36(k.ux))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-cancelation-with-code"]],decls:6,vars:3,consts:[["fxLayout","column",3,"formGroup","submit"],["matInput","","formControlName","code","placeholder","Buchungscode"],["fxLayout","row","fxLayoutAlign","end center"],[3,"disabled","loading","click"]],template:function(t,e){1&t&&(g.TgZ(0,"form",0),g.NdJ("submit",function(){return e.cancel()}),g.TgZ(1,"mat-form-field"),g._UZ(2,"input",1),g.qZA(),g.TgZ(3,"div",2),g.TgZ(4,"app-loading-button",3),g.NdJ("click",function(){return e.cancel()}),g._uU(5," Stornieren "),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.Q6J("formGroup",e.cancelationFormGroup),g.xp6(4),g.Q6J("disabled",e.cancelationFormGroup.invalid)("loading",e.cancelationInProgress))},directives:[s._Y,s.JL,O.xw,s.sg,F.KE,H.Nt,s.Fj,s.JJ,s.u,O.Wh,V.v],styles:[""]}),t})();var kt=n(2238),Zt=n(1095);let xt=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-confirm-cancelation"]],decls:7,vars:2,consts:[["align","end","fxLayoutGap","8px"],["mat-flat-button","",3,"mat-dialog-close"],[3,"mat-dialog-close"]],template:function(t,e){1&t&&(g.TgZ(0,"p"),g._uU(1,"Wollen Sie die Buchung wirklich stornieren?"),g.qZA(),g.TgZ(2,"mat-dialog-actions",0),g.TgZ(3,"button",1),g._uU(4,"Nein"),g.qZA(),g.TgZ(5,"app-loading-button",2),g._uU(6,"Ja"),g.qZA(),g.qZA()),2&t&&(g.xp6(3),g.Q6J("mat-dialog-close",!1),g.xp6(2),g.Q6J("mat-dialog-close",!0))},directives:[kt.H8,O.SQ,Zt.lW,kt.ZT,V.v],styles:[""]}),t})();var vt=n(6627);function At(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"table"),g._UZ(1,"br"),g.TgZ(2,"tr"),g.TgZ(3,"td"),g._uU(4,"Arbeitsplatz:"),g.qZA(),g.TgZ(5,"td"),g._uU(6),g.qZA(),g.qZA(),g._UZ(7,"br"),g.TgZ(8,"tr"),g.TgZ(9,"td"),g._uU(10,"Standort:"),g.qZA(),g.TgZ(11,"td"),g._uU(12),g.qZA(),g.qZA(),g.TgZ(13,"tr"),g.TgZ(14,"td"),g._uU(15,"Zeit:"),g.qZA(),g.TgZ(16,"td"),g._uU(17),g.ALo(18,"date"),g.ALo(19,"date"),g.qZA(),g.qZA(),g.TgZ(20,"tr"),g.TgZ(21,"td"),g._uU(22,"Tag:"),g.qZA(),g.TgZ(23,"td"),g._uU(24),g.ALo(25,"date"),g.qZA(),g.qZA(),g._UZ(26,"br"),g.TgZ(27,"tr"),g.TgZ(28,"td"),g._uU(29,"Buchungs-nummer:"),g.qZA(),g.TgZ(30,"td"),g._uU(31),g.qZA(),g.qZA(),g._UZ(32,"br"),g.TgZ(33,"tr"),g.TgZ(34,"td",3),g.TgZ(35,"div",4),g.TgZ(36,"app-loading-button",5),g.NdJ("click",function(){const e=g.CHM(t).ngIf;return g.oxw().cancelBooking(e)}),g._uU(37," Stornieren "),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=e.ngIf,n=g.oxw();g.xp6(6),g.Oqu(t.id),g.xp6(6),g.Oqu(t.institution),g.xp6(5),g.AsE("",g.xi3(18,7,t.start,"HH:mm")," - ",g.xi3(19,10,t.end,"HH:mm"),""),g.xp6(7),g.Oqu(g.xi3(25,13,t.start,"longDate")),g.xp6(7),g.Oqu(t.bookingCode),g.xp6(5),g.Q6J("loading",n.cancelationInProgress)}}function Tt(t,e){1&t&&g._UZ(0,"bullet-list-content-loader")}let yt=(()=>{class t{constructor(t,e,n,o,r){this.bookingService=t,this.activeRoute=e,this.router=n,this.dialog=o,this.datePipe=r,this.bookingListRoute="/"+i.l.BOOKING_LIST}ngOnInit(){this.booking$=this.activeRoute.params.pipe((0,w.zg)(t=>this.bookingService.getBooking(t.id)))}cancelBooking(t){this.dialog.open(xt).afterClosed().subscribe(e=>{e&&(this.cancelationInProgress=!0,this.bookingService.cancelBooking(t.bookingCode,this.datePipe.transform(t.start,"HH:mm"),this.datePipe.transform(t.end,"HH:mm")).subscribe(()=>{this.cancelationInProgress=!1,this.router.navigate(["/",i.l.BOOKING_LIST])}))})}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(I),g.Y36(o.gz),g.Y36(o.F0),g.Y36(kt.uw),g.Y36(J.uU))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-booking-information"]],decls:7,vars:5,consts:[["mat-button","",1,"back-button",3,"routerLink"],[4,"ngIf","ngIfElse"],["loading",""],["colspan","2"],["fxLayout","row","fxLayoutAlign","end center"],[3,"loading","click"]],template:function(t,e){if(1&t&&(g.TgZ(0,"button",0),g.TgZ(1,"mat-icon"),g._uU(2,"close"),g.qZA(),g.qZA(),g.YNc(3,At,38,16,"table",1),g.ALo(4,"async"),g.YNc(5,Tt,1,0,"ng-template",null,2,g.W1O)),2&t){const t=g.MAs(6);g.Q6J("routerLink",e.bookingListRoute),g.xp6(3),g.Q6J("ngIf",g.lcZ(4,3,e.booking$))("ngIfElse",t)}},directives:[Zt.lW,o.rH,vt.Hw,J.O5,O.xw,O.Wh,V.v,rt.aF],pipes:[J.Ov,J.uU],styles:[".back-button[_ngcontent-%COMP%]{width:34px;height:34px;padding:0;min-width:unset;line-height:unset;position:absolute;right:16px}table[_ngcontent-%COMP%]{width:100%}"]}),t})();var wt=n(9992);function _t(t,e){if(1&t&&(g.TgZ(0,"a",9),g.TgZ(1,"div",10),g.TgZ(2,"span",11),g.TgZ(3,"span",12),g._uU(4),g.qZA(),g.TgZ(5,"span",13),g._uU(6),g.qZA(),g.qZA(),g.TgZ(7,"span",14),g._uU(8),g.ALo(9,"date"),g.qZA(),g.TgZ(10,"span",14),g._uU(11),g.ALo(12,"date"),g.ALo(13,"date"),g.qZA(),g.qZA(),g.qZA()),2&t){const t=e.$implicit,n=g.oxw(3);g.Q6J("routerLink",n.getLink(t.bookingCode)),g.xp6(4),g.hij("",t.institution,": "),g.xp6(2),g.hij(" Platz ",t.id," "),g.xp6(2),g.hij(" ",g.xi3(9,6,t.start,"dd MMM"),""),g.xp6(3),g.AsE(" ",g.xi3(12,9,t.start,"HH:mm")," - ",g.xi3(13,12,t.end,"HH:mm")," ")}}function St(t,e){if(1&t&&(g.ynx(0),g.YNc(1,_t,14,15,"a",8),g.BQk()),2&t){const t=g.oxw().ngIf;g.xp6(1),g.Q6J("ngForOf",t)}}function It(t,e){if(1&t&&(g.TgZ(0,"mat-list",6),g.YNc(1,St,2,1,"ng-container",7),g.qZA()),2&t){const t=e.ngIf;g.oxw();const n=g.MAs(7);g.xp6(1),g.Q6J("ngIf",t.length)("ngIfElse",n)}}function qt(t,e){1&t&&(g.TgZ(0,"span"),g._uU(1,"Keine Buchungen gefunden"),g.qZA())}function Ot(t,e){1&t&&g._UZ(0,"bullet-list-content-loader")}let Ft=(()=>{class t{constructor(t){this.bookingService=t,this.bookings$=this.bookingService.getBookings()}getLink(t){return"/"+i.l.BOOKING_INFO.replace(":id",t)}get cancelationRoute(){return"/"+i.l.CANCELATION}ngOnInit(){}reload(){this.bookingService.reloadBookings()}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(I))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-booking-list"]],decls:10,vars:4,consts:[[3,"swipeDown"],["role","list",4,"ngIf","ngIfElse"],["fxLayoutAlign","end center"],["mat-button","",3,"click"],["noBookings",""],["loading",""],["role","list"],[4,"ngIf","ngIfElse"],["mat-list-item","","role","listitem",3,"routerLink",4,"ngFor","ngForOf"],["mat-list-item","","role","listitem",3,"routerLink"],["fxLayout","row","fxFlex","","fxLayoutGap","16px","fxLayoutAlign","start center",2,"width","100%"],["fxFlex","1 1 auto",2,"overflow","hidden","white-space","break-spaces"],[2,"white-space","nowrap","overflow","hidden"],[2,"white-space","nowrap"],["fxFlex","0 0 auto"]],template:function(t,e){if(1&t&&(g.TgZ(0,"div",0),g.NdJ("swipeDown",function(){return e.reload()}),g.YNc(1,It,2,2,"mat-list",1),g.ALo(2,"async"),g.TgZ(3,"div",2),g.TgZ(4,"button",3),g.NdJ("click",function(){return e.reload()}),g._uU(5,"Aktualisieren"),g.qZA(),g.qZA(),g.qZA(),g.YNc(6,qt,2,0,"ng-template",null,4,g.W1O),g.YNc(8,Ot,1,0,"ng-template",null,5,g.W1O)),2&t){const t=g.MAs(9);g.xp6(1),g.Q6J("ngIf",g.lcZ(2,2,e.bookings$))("ngIfElse",t)}},directives:[J.O5,O.Wh,Zt.lW,wt.i$,J.sg,wt.Tg,o.yS,O.xw,O.yH,O.SQ,rt.aF],pipes:[J.Ov,J.uU],styles:["a[_ngcontent-%COMP%]{border-bottom:1px solid #f1f1f1}a[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.mat-list-base[_ngcontent-%COMP%]{padding-top:0}"]}),t})(),Ut=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[o.Bz.forChild([{path:i.l.BOOKING,component:mt,data:{title:["Arbeitsplatz buchen"]},canActivate:[dt.a]},{path:i.l.CANCELATION,component:bt,data:{title:["Buchungen","Stornieren"]},canActivate:[dt.a]},{path:i.l.BOOKING_INFO,component:yt,data:{title:["Buchungen","Buchung"]},canActivate:[dt.a]},{path:i.l.BOOKING_LIST,component:Ft,data:{title:["Buchungen"]},canActivate:[dt.a]}])]]}),t})()}}]);